const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["../chunks/I5cRc99g.js","../chunks/-oqUeG8m.js","../chunks/Bh3CESDH.js","../chunks/DIeogL5L.js","../chunks/DsnmJJEf.js","../chunks/69_IOA4Y.js","../chunks/PeS4DD_1.js","../chunks/DIm2KDQv.js","../chunks/D4yQbxo0.js","../chunks/B9_04sHa.js","../assets/icon-button.YsgTUtJ8.css","../assets/lite-bills.DT8HWnAi.css"])))=>i.map(i=>d[i]);
import"../chunks/DsnmJJEf.js";import"../chunks/69_IOA4Y.js";import{s as q,o as Te,b as qe}from"../chunks/PeS4DD_1.js";import{A as Le,j as r,B as Qe,m as y,bl as Ue,D as ve,o as B,w as i,z as n,v,t as D,H as ue,F as ce,G as U,aq as w,an as k,bi as ae,l as e,bj as be,y as ge,b8 as ze,aI as Re,a4 as Oe,x as ie,aK as Ye,bm as je,i as Ge,q as Be,I as Ne}from"../chunks/Bh3CESDH.js";import{p as x,i as L,a as fe,s as $e,c as pe}from"../chunks/DIm2KDQv.js";import{i as _e}from"../chunks/B9_04sHa.js";import{j as Z,d as me,k as Ve,l as Ke,m as he,g as Ie,I as He,n as Xe,r as xe,o as Fe}from"../chunks/D4yQbxo0.js";import{g as Ce}from"../chunks/CaxEHoRa.js";import{_ as We,b as Je}from"../chunks/B4dlH-Bq.js";import{C as Ae,a as ke,b as Ze,c as Pe,L as et,l as tt}from"../chunks/-oqUeG8m.js";import{u as at}from"../chunks/De2Pp9YM.js";function rt(S,a,t){Le(()=>{var o=r(()=>a(S,t?.())||{});if(t&&o?.update){var f=!1,l={};Qe(()=>{var h=t();y(h),f&&Ue(l,h)&&(l=h,o.update(h))}),f=!0}if(o?.destroy)return()=>o.destroy()})}var nt=B('<span class="pill--filled svelte-rf6rz1"></span> <span class="pill--empty svelte-rf6rz1"></span> <span class="pill--filled svelte-rf6rz1"></span>',1),lt=B('<span class="pill--empty svelte-rf6rz1"></span> <span class="pill--filled svelte-rf6rz1"></span> <span class="pill--empty svelte-rf6rz1"></span>',1),st=B('<span class="item-title svelte-rf6rz1"> </span>'),it=B('<div class="item"><div class="pill svelte-rf6rz1"><!></div> <!></div>');function ot(S,a){ve(a,!1);let t=x(a,"item",8),o=x(a,"showLabel",8,!0);_e();var f=it(),l=i(f),h=i(l);{var I=g=>{var C=nt(),T=ce(C);Z(T,"data-start",0);var _=v(T,2),z=v(_,2);U(()=>{me(T,(y(t()),r(()=>`flex-grow: ${t().payByDate}`))),Z(_,"data-start",(y(t()),r(()=>t().payByDate))),me(_,(y(t()),r(()=>`flex-grow: ${t().billingDate-t().payByDate+1}`))),Z(z,"data-start",(y(t()),r(()=>t().billingDate))),me(z,(y(t()),r(()=>`flex-grow: ${31-t().billingDate+1}`)))}),D(g,C)},P=g=>{var C=lt(),T=ce(C);Z(T,"data-start",0);var _=v(T,2),z=v(_,2);U(()=>{me(T,(y(t()),r(()=>`flex-grow: ${t().billingDate}`))),Z(_,"data-start",(y(t()),r(()=>t().billingDate))),me(_,(y(t()),r(()=>`flex-grow: ${t().payByDate}`))),Z(z,"data-start",(y(t()),r(()=>t().payByDate))),me(z,(y(t()),r(()=>`flex-grow: ${31-t().billingDate+1}`)))}),D(g,C)};L(h,g=>{y(t()),r(()=>t().billingDate>t().payByDate)?g(I):g(P,!1)})}n(l);var F=v(l,2);{var $=g=>{var C=st();Z(C,"data-start",0);var T=i(C,!0);n(C),U(()=>{Z(C,"data-length",(y(t()),r(()=>t().payByDate))),q(T,(y(t()),r(()=>t().name)))}),D(g,C)};L(F,g=>{o()&&g($)})}n(f),D(S,f),ue()}var dt=B('<div class="idea-card svelte-utja49"><!> <p class="svelte-utja49"> </p></div>');function ct(S,a){let t=x(a,"idea",8);var o=dt(),f=i(o);Ve(f,{get data(){return Ke},scale:1,style:"border-radius: 4rem; color: #ffa029; padding: 0 1rem 0 .5rem; cursor: pointer; align-self: center"});var l=v(f,2),h=i(l,!0);n(l),n(o),U(()=>q(h,t())),D(S,o)}const Se=S=>{const t=new Date().getTime()-S.getTime(),o=Math.floor(t/6e4),f=Math.floor(o/60),l=Math.floor(f/24),h=new Intl.RelativeTimeFormat("en",{numeric:"auto"});return o<1?"just now":o<60?h.format(-o,"minute"):f<24?h.format(-f,"hour"):l<31?h.format(-l,"day"):S.toLocaleDateString("en-GB")};var vt=B("<h1> </h1>"),ut=B("<h1>Recent Transactions</h1>"),mt=B('<a class="svelte-1gzei9r">view all</a>'),ft=B("<p>We don't see any transactions this month so far...</p>"),_t=B(`<h2 class="recent-spends__title svelte-1gzei9r">Your recent spends</h2> <div class="recent-spends__content svelte-1gzei9r"><div class="recent-spends__spend-tile svelte-1gzei9r"><p>Today's spend</p> <p class="recent-spends__spend-amount svelte-1gzei9r"> </p></div> <div class="recent-spends__spend-tile svelte-1gzei9r"><p>This month's spend</p> <p class="recent-spends__spend-amount svelte-1gzei9r"> </p></div></div>`,1),yt=B('<div></div> <!> <p class="disclaimer svelte-1gzei9r">It might take upto an hour for latest transactions to show up here...</p>',1),pt=B('<div class="transaction-card svelte-1gzei9r"><div class="recent-transaction svelte-1gzei9r"><div class="non-amount-details svelte-1gzei9r"><span class="svelte-1gzei9r">Total spend</span></div> <span class="svelte-1gzei9r"> </span></div></div> <hr/>',1),gt=B('<span class="svelte-1gzei9r"> </span>'),ht=B('<span class="svelte-1gzei9r">Unknown</span>'),bt=B('<span class="svelte-1gzei9r"> </span>'),Dt=B('<span class="svelte-1gzei9r">-</span>'),wt=B('<a class="transaction-card svelte-1gzei9r"><div class="recent-transaction svelte-1gzei9r"><div class="non-amount-details svelte-1gzei9r"><!> <span class="paid-on svelte-1gzei9r"> </span></div> <!></div></a>'),St=B(`<p>Not seeing a transaction here? You can <a class="transaction-add-cta svelte-1gzei9r">add one</a> manually
      too.</p>`),Tt=B('<div class="container svelte-1gzei9r"><div><!> <!></div> <!> <!> <!> <!> <!></div>');function xt(S,a){ve(a,!1);const t=k(),o=k(),f=k(),l=k();let h=x(a,"transactions",24,()=>[]),I=x(a,"showViewAllCTA",8,!0),P=x(a,"showAllTransactions",8,!1),F=x(a,"showRecentSpends",8,!1),$=x(a,"showGraph",8,!1),g=x(a,"showTotalSpend",8,!0),C=x(a,"title",8,void 0),T=x(a,"totalSpend",12,0),_=x(a,"initialShowCount",8,5);Te(async()=>{if(window.ApexCharts){w(l,window.ApexCharts);return}await z()});const z=async()=>{const s=await We(()=>import("../chunks/I5cRc99g.js").then(m=>m.a),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11]),import.meta.url);window.ApexCharts=s.default,w(l,s.default)},ee=(s,m)=>{if(!e(l))return;if(m.length>0){let u=new Date(e(t)[0].paidAt),J=new Date(u.getUTCFullYear(),u.getUTCMonth()+1,0).getDate();for(let le=1;le<=J;le++){let oe=new Date(u.getUTCFullYear(),u.getUTCMonth(),le);e(t).find(de=>new Date(de.paidAt).getDate()===oe.getDate()&&new Date(de.paidAt).getMonth()===oe.getMonth()&&new Date(de.paidAt).getFullYear()===oe.getFullYear())||e(t).push({paidAt:oe.toISOString(),amount:0})}}let N=e(t).map(u=>({x:new Date(u.paidAt).getDate(),y:u.amount,note:`${u.amount}`})).reduce((u,M,J)=>{if(J==0)return[M];if(M.x==u[u.length-1].x){let le=u[u.length-1];return[...u.slice(0,-1),{y:le.y+M.y,x:le.x,note:`${le.note} - + ${M.y}`}]}return[...u,{x:M.x,y:M.y,note:M.note}]},[]);N.sort((u,M)=>u.x-M.x),T(N.reduce((u,M)=>u+M.y,0));let p={colors:["var(--primary-color)"],legend:{show:!1},stroke:{curve:"smooth",width:2},chart:{type:"area"},series:[{name:"payments",data:N.map(u=>u.y)}],xaxis:{categories:N.map(u=>u.x),labels:{show:!0}},yaxis:{labels:{show:!1}},dataLabels:{enabled:!0,style:{colors:["#5e5e5e"]},formatter:u=>u===0?void 0:`â‚¹ ${Intl.NumberFormat(void 0,{style:"decimal"}).format(u)}`}},b=new(e(l))(s,p);return b.render(),{update(u){b.updateOptions(u)},destroy(){b.destroy()}}};ae(()=>y(h()),()=>{w(t,h().reduce((s,m)=>s.findIndex(N=>N.id===m.id)===-1?[...s,m]:s,[]).filter(s=>s.paidAt))}),ae(()=>{},()=>{w(o,new Intl.DateTimeFormat("en-CA").format(new Date))}),ae(()=>(e(t),e(o)),()=>{w(f,e(t).filter(s=>new Intl.DateTimeFormat("en-CA").format(new Date(s.paidAt))===e(o)).reduce((s,m)=>s+m.amount,0))}),ae(()=>{},()=>{w(l,void 0)}),be(),_e();var V=Tt(),K=i(V),re=i(K);{var ne=s=>{var m=vt(),R=i(m,!0);n(m),U(()=>q(R,C())),D(s,m)},E=s=>{var m=ut();D(s,m)};L(re,s=>{C()!==void 0?s(ne):s(E,!1)})}var O=v(re,2);{var X=s=>{var m=mt();Z(m,"href","transactions"),D(s,m)};L(O,s=>{I()&&s(X)})}n(K);var Y=v(K,2);{var H=s=>{var m=ft();D(s,m)};L(Y,s=>{y(h()),r(()=>h().length===0)&&s(H)})}var G=v(Y,2);{var W=s=>{var m=yt(),R=ce(m);rt(R,(b,u)=>ee?.(b,u),h);var N=v(R,2);{var p=b=>{var u=_t(),M=v(ce(u),2),J=i(M),le=v(i(J),2),oe=i(le,!0);n(le),n(J);var de=v(J,2),De=v(i(de),2),j=i(De,!0);n(De),n(de),n(M),U((te,ye)=>{q(oe,te),q(j,ye)},[()=>(e(f),r(()=>new Intl.NumberFormat(void 0,{style:"currency",currency:"INR",maximumFractionDigits:2}).format(e(f)))),()=>(y(T()),r(()=>new Intl.NumberFormat(void 0,{style:"currency",currency:"INR",maximumFractionDigits:2}).format(T())))]),D(b,u)};L(N,b=>{F()&&b(p)})}ge(2),D(s,m)};L(G,s=>{y($()),y(h()),e(l),r(()=>$()&&h().length>0&&e(l))&&s(W)})}var se=v(G,2);{var A=s=>{var m=pt(),R=ce(m),N=i(R),p=v(i(N),2),b=i(p,!0);n(p),n(N),n(R),ge(2),U(u=>q(b,u),[()=>(y(T()),r(()=>new Intl.NumberFormat(void 0,{style:"currency",currency:"INR"}).format(T())))]),D(s,m)};L(se,s=>{g()&&s(A)})}var d=v(se,2);he(d,1,()=>(y(P()),e(t),y(_()),r(()=>P()?e(t):e(t).slice(0,_()))),s=>s.id,(s,m)=>{var R=wt(),N=i(R),p=i(N),b=i(p);{var u=j=>{var te=gt(),ye=i(te,!0);n(te),U(()=>q(ye,(e(m),r(()=>e(m).merchant)))),D(j,te)},M=j=>{var te=ht();D(j,te)};L(b,j=>{e(m),r(()=>e(m).merchant!==null)?j(u):j(M,!1)})}var J=v(b,2),le=i(J,!0);n(J),n(p);var oe=v(p,2);{var de=j=>{var te=bt(),ye=i(te,!0);n(te),U(Me=>q(ye,Me),[()=>(e(m),r(()=>new Intl.NumberFormat(void 0,{style:"currency",currency:"INR"}).format(e(m).amount)))]),D(j,te)},De=j=>{var te=Dt();D(j,te)};L(oe,j=>{e(m),r(()=>e(m).amount!==null)?j(de):j(De,!1)})}n(N),n(R),U(j=>{Z(R,"href",(e(m),r(()=>`/transaction?id=${e(m).id}`))),q(le,j)},[()=>(y(Se),e(m),r(()=>Se(new Date(e(m).paidAt))))]),D(s,R)});var c=v(d,2);{var Q=s=>{var m=St(),R=v(i(m));Z(R,"href","transaction/add"),ge(),n(m),D(s,m)};L(c,s=>{I()&&s(Q)})}n(V),U(()=>Ie(K,1,`title ${C()===""?"title--hidden":""}`,"svelte-1gzei9r")),D(S,V),ue()}const we=S=>{let a=S%10,t=S%100;return a===1&&t!==11?S+"st":a===2&&t!==12?S+"nd":a===3&&t!==13?S+"rd":S+"th"},Bt=S=>{if(!S.billingDate)return null;const a=new Date,t=a.getFullYear(),o=a.getMonth(),f=a.getDate(),l=T=>T.toString().padStart(2,"0");function h(T,_,z){return`${T}-${l(_+1)}-${l(z)}`}let I=t,P=o,F=t,$=o,g,C;return g=S.billingDate+1,C=S.billingDate,P=S.billingDate>f?o-2:o-1,$=P+1,I=t,F=t,{fromDate:h(I,P,g),toDate:h(F,$,C)}};var Ct=async(S,a)=>{await a()?.(S)},It=B('<button class="button-container svelte-6f3vd4"><!></button>');function Ft(S,a){ve(a,!0);let t=x(a,"onclick",3,void 0),o=x(a,"state",3,"DEFAULT");var f=It();f.__click=[Ct,t];var l=i(f);{var h=P=>{He(P,{get icon(){return Xe},scale:.75})},I=P=>{var F=Re(),$=ce(F);qe($,()=>a.children??Oe),D(P,F)};L(l,P=>{o()==="LOADING"?P(h):P(I,!1)})}n(f),D(S,f),ue()}ze(["click"]);var At=B("<p> </p>"),kt=B("<div><!></div>"),Pt=B('<p><input type="checkbox" class="svelte-14qqrs6"/> <span> </span> <span> </span></p>'),zt=B('<label for="record-bill-payment-amount">Total Amount (calculated from selected transactions)</label> <p class="total-amount svelte-14qqrs6"> </p>',1),Rt=B('<div class="container svelte-14qqrs6"><div class="form-container svelte-14qqrs6"><h2>Record a payment</h2> <label for="record-bill-payment-bill">Bill</label> <!> <label for="record-bill-statement">Bill Cycle</label> <!> <label for="record-bill-payment-amount">Amount</label> <input id="record-bill-payment-amount" placeholder="Enter amount paid or search" class="svelte-14qqrs6"/>  <!>  <!> <div class="checkbox-group svelte-14qqrs6"><label for="record-bill-payment-fullypaid">Fully Paid</label> <input type="checkbox" name="record-bill-payment-fullypaid" id="record-bill-payment-fullypaid" class="svelte-14qqrs6"/></div> <!></div></div>');function Nt(S,a){ve(a,!1);const t=()=>fe(e(T),"$matchingTransactionsQuery",o),[o,f]=$e(),l=k(),h=k();let I=x(a,"bill",8),P=x(a,"billStatements",8),F=x(a,"onRecordingPayment",8),$=x(a,"lockBillStatementCycle",8,!1),g=x(a,"selectedStatement",8),C=x(a,"onTransactionSearch",8),T=k(),_=k(""),z=k(!0),ee=k(!1);class V{__state;__metadata;constructor(c,Q){this.__state=c,this.__metadata=Q}get state(){return this.__state}set state(c){this.__state=c}get metadata(){return this.__metadata}}const K=async()=>{try{pe(w(T,await C()(e(_))),"$matchingTransactionsQuery",o)}catch{}};ae(()=>t(),()=>{w(l,t()?.data?.reduce((d,c)=>(d={...d,[c.id.toString()]:new V(!1,c)},d),{})??{})}),ae(()=>e(l),()=>{w(h,Object.values(e(l)).filter(d=>d.state).reduce((d,c)=>d+c.metadata?.amount||0,0))}),ae(()=>y(g()),()=>{console.log("selec",g())}),be(),_e();var re=Rt(),ne=i(re),E=v(i(ne),4);{let d=ie(()=>!$());Ee(E,{get bill(){return I()},billingStatements:[],showRecordPaymentButton:!1,onRecordingPayment:()=>{},get currentCycleFromDate(){return y(g()),r(()=>g().startDate)},get currentCycleToDate(){return y(g()),r(()=>g().endDate)},get showBillingCycle(){return e(d)}})}var O=v(E,4);he(O,1,P,d=>d.id,(d,c)=>{var Q=kt(),s=i(Q);Ae(s,{children:(m,R)=>{var N=At(),p=i(N,!0);n(N),U(()=>q(p,(e(c),r(()=>`${e(c).startDate} - ${e(c).endDate}`)))),D(m,N)},$$slots:{default:!0}}),n(Q),U(()=>Ie(Q,1,(y($()),e(c),y(g()),r(()=>`bill-statement ${$()?"bill-statement--locked":""} ${e(c).id===g().id?"bill-statement--selected":""}`)),"svelte-14qqrs6")),D(d,Q)});var X=v(O,4);xe(X),X.__focusout=K;var Y=v(X,2);he(Y,1,()=>(t(),r(()=>t()?.data)),d=>d.id,(d,c)=>{Ae(d,{children:(Q,s)=>{var m=Pt(),R=i(m);xe(R);var N=v(R,2),p=i(N,!0);n(N);var b=v(N,1,!0),u=v(b),M=i(u,!0);n(u),n(m),U(J=>{Z(R,"name",(e(c),r(()=>`record-bill-payment-transaction-${e(c).id}`))),Z(R,"id",(e(c),r(()=>`record-bill-payment-transaction-${e(c).id}`))),q(p,(e(c),r(()=>`â‚¹${e(c).amount}/- `))),q(b,(e(c),r(()=>`at ${e(c).merchant??"Unknown Merchant"} Â· `))),q(M,J)},[()=>(y(Se),e(c),r(()=>Se(new Date(e(c).paidAt))))]),ke(R,()=>e(l)[e(c).id].state,J=>je(l,e(l)[e(c).id].state=J)),D(Q,m)},$$slots:{default:!0}})});var H=v(Y,2);{var G=d=>{var c=zt(),Q=v(ce(c),2),s=i(Q,!0);n(Q),U(()=>q(s,`â‚¹ ${e(h)}/-`)),D(d,c)};L(H,d=>{e(l),r(()=>Object.values(e(l)).filter(c=>c.state).length>0)&&d(G)})}var W=v(H,2),se=v(i(W),2);xe(se),n(W);var A=v(W,2);{let d=ie(()=>e(ee)?"LOADING":"DEFAULT");Ft(A,{onclick:async()=>{w(ee,!0),await F()({id:g().id,amount:Object.values(e(l)).filter(c=>c.state).length>0?e(h):+e(_),bill:I(),cycleFromDate:g().startDate,cycleToDate:g().endDate,isFullyPaid:e(z),transactions:Object.values(e(l)).filter(c=>c.state).map(c=>c.metadata)}),w(ee,!1)},get state(){return e(d)},children:(c,Q)=>{ge();var s=Ye("Record Payment");D(c,s)},$$slots:{default:!0}})}n(ne),n(re),Ze(X,()=>e(_),d=>w(_,d)),ke(se,()=>e(z),d=>w(z,d)),D(S,re),ue(),f()}ze(["focusout"]);function $t(S,a){ve(a,!0),Ge(()=>{at.update(t=>({...t,content:a.children,onClose:a.onClose}))}),ue()}var Et=B('<div class="actions"><button class="svelte-k426ci">Record payment</button></div>'),Mt=B('<div class="card-item svelte-k426ci"> </div>'),qt=B('<div class="card-item svelte-k426ci">Total Payment made this cycle: <span class="current-bill-amount svelte-k426ci"> </span></div>'),Lt=B(`<div class="container svelte-k426ci"><a aria-label="anchor"></a> <div class="header svelte-k426ci"><div class="name svelte-k426ci"> </div> <!></div> <!> <div class="card-item svelte-k426ci">Bill generates <strong class="svelte-k426ci"> </strong> of every
    month and due <strong class="svelte-k426ci"> </strong> of every
    month</div> <!> <div class="card-item svelte-k426ci">Current bill status <span><strong class="svelte-k426ci"> </strong></span></div> <!></div>`);function Ee(S,a){ve(a,!1);let t=x(a,"bill",8),o=x(a,"billingStatements",8),f=x(a,"showRecordPaymentButton",8,!0),l=x(a,"title",8,""),h=x(a,"showBillingCycle",8,!0),I=x(a,"onRecordingPayment",8);x(a,"onCurrentBillStatementDoesNotExist",8);let P=k(),F=k(),$=x(a,"currentCycleFromDate",12,""),g=x(a,"currentCycleToDate",12,""),C=k(),T=k(),_=k();Te(()=>{w(P,new Date().getDate())}),ae(()=>(y(t()),e(_),y(o()),e(P)),()=>{const p=Bt(t());w(_,o()?.find(u=>u.startDate===p?.fromDate&&p?.toDate===u.endDate)),e(_)||w(_,{startDate:p?.fromDate,endDate:p?.toDate,amount:void 0}),$(p?.fromDate||""),g(p?.toDate||"");const b=t().payByDate-e(P);t().isEnabled?o()?e(_)?.isFullyPaid&&e(_)?.amount===0?w(F,{string:"No payment due",status:"paid"}):e(_)?.isFullyPaid?w(F,{string:"Fully Paid",status:"paid"}):b>0?w(F,{string:`Due in ${b} days`,status:"due",l2Status:b<=5?"warning":"ok"}):b<0?w(F,{string:`Overdue by ${-b} days`,status:"overdue"}):w(F,{string:"Due today",status:"today"}):w(F,{string:"Calculating ...",status:"loading"}):w(F,{string:"Disabled",status:"disabled"})}),be(),_e();var z=Lt(),ee=i(z),V=v(ee,2),K=i(V),re=i(K,!0);n(K);var ne=v(K,2);{var E=p=>{var b=Et(),u=i(b);n(b),Be("click",u,()=>{Ce(`#payment__bill_${t().id}`),w(T,null),w(T,t())}),D(p,b)};L(ne,p=>{y(t()),y(f()),r(()=>t().isEnabled&&f())&&p(E)})}n(V);var O=v(V,2);{var X=p=>{$t(p,{onClose:()=>{w(T,null)},children:(b,u)=>{{let M=ie(()=>[e(_)]);Nt(b,{get bill(){return e(T)},get onRecordingPayment(){return I()},get billStatements(){return e(M)},get selectedStatement(){return e(_)}})}},$$slots:{default:!0}})};L(O,p=>{e(T)&&p(X)})}var Y=v(O,2),H=v(i(Y)),G=i(H,!0);n(H);var W=v(H,2),se=i(W,!0);n(W),ge(),n(Y);var A=v(Y,2);{var d=p=>{var b=Mt(),u=i(b);n(b),U(()=>q(u,`Billing cycle: ${$()??""} - ${g()??""}`)),D(p,b)};L(A,p=>{h()&&p(d)})}var c=v(A,2),Q=v(i(c)),s=i(Q),m=i(s,!0);n(s),n(Q),n(c);var R=v(c,2);{var N=p=>{var b=qt(),u=v(i(b)),M=i(u);n(u),n(b),U(()=>q(M,`â‚¹${e(_),r(()=>e(_)?.amount)??""}/-`)),D(p,b)};L(R,p=>{e(_),r(()=>e(_)?.amount>0)&&p(N)})}n(z),Je(z,p=>w(C,p),()=>e(C)),U((p,b)=>{Z(ee,"href",(y(t()),r(()=>`#payment__bill_${t().id}`))),q(re,(y(l()),y(t()),r(()=>l()?.length>0?l():t().name))),q(G,p),q(se,b),Ie(Q,1,(e(F),r(()=>`due-status due-status--${e(F)?.status} ${e(F)?.l2Status?`due-status--${e(F)?.status}--${e(F)?.l2Status}`:""}`)),"svelte-k426ci"),q(m,(e(F),r(()=>e(F)?.string)))},[()=>(y(we),y(t()),r(()=>we(t().billingDate))),()=>(y(we),y(t()),r(()=>we(t().payByDate)))]),D(S,z),ue()}var Qt=B('<h1 class="title_bill svelte-9nf6o4">Your bills</h1>'),Ut=B('<button class="bill svelte-9nf6o4"><!></button>'),Ot=B(`<div class="timeline svelte-9nf6o4"><div class="timeline-data svelte-9nf6o4"><!> <!> <p class="stay-updated svelte-9nf6o4">Stay updated with the bills you need to pay this month...</p> <!> <div class="items bill-payments svelte-9nf6o4"></div> <h1 class="title_bill svelte-9nf6o4">Billing Cycles</h1> <p>Each month, your bills are generated at the start of the bar, and are to
      be paid when the bar ends. Bars wrapping around mean they can be paid the
      next month</p> <div class="legend legend-top svelte-9nf6o4"><span class="svelte-9nf6o4">1</span> <span class="svelte-9nf6o4"> </span></div> <div class="items svelte-9nf6o4"></div> <div class="legend legend-bottom svelte-9nf6o4"><span class="svelte-9nf6o4">1</span> <span class="svelte-9nf6o4"> </span></div></div> <button class="cta svelte-9nf6o4">Add bill</button></div>`);function Yt(S,a){ve(a,!1);const t=k();let o=x(a,"title",12,""),f=x(a,"items",24,()=>[]),l=x(a,"stats",24,()=>({})),h=x(a,"transactions",24,()=>[]),I=x(a,"billingStatements",8),P=x(a,"onRecordingPayment",8),F=x(a,"onCurrentBillStatementDoesNotExist",8),$=k(31),g=k([]),C=k("");Te(()=>{let A=new Date(new Date().getUTCFullYear(),new Date().getUTCMonth()+1,0);w($,A.getDate()),w(C,Intl.DateTimeFormat(void 0,{month:"long"}).format(A)),o()===""&&o(`Timeline view for ${e(C)}`),w(g,l().stats.filter(d=>d.type==="FULL_PAYMENT_DATES"))}),ae(()=>y(f()),()=>{w(t,f().toSorted((A,d)=>A.isEnabled?d.isEnabled?A.billingDate==null&&A.payByDate==null&&d.billingDate==null&&d.payByDate==null?-1:A.name.localeCompare(d.name):Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY))}),be(),_e();var T=Ot(),_=i(T),z=i(_);xt(z,{get transactions(){return h()},showGraph:!0,get title(){return o()},showRecentSpends:!0,showTotalSpend:!1});var ee=v(z,2);{var V=A=>{var d=Qt();D(A,d)};L(ee,A=>{e(t),r(()=>e(t).length>0)&&A(V)})}var K=v(ee,4);{var re=A=>{{let d=ie(()=>(e(C),e(g),r(()=>`Pay all bills together by paying between ${e(C)} ${e(g)[0].dateRanges[0].start} and ${e(C)} ${e(g)[0].dateRanges[0].end}!`)));ct(A,{get idea(){return e(d)}})}};L(K,A=>{e(g),r(()=>e(g).length>0)&&A(re)})}var ne=v(K,2);he(ne,5,()=>(e(t),r(()=>e(t).filter(A=>A.payByDate!==null))),Fe,(A,d)=>{{let c=ie(()=>(y(I()),e(d),r(()=>I()?.[`billStatements__bill_${e(d).id}`])));Ee(A,{get bill(){return e(d)},get billingStatements(){return e(c)},get onRecordingPayment(){return P()},get onCurrentBillStatementDoesNotExist(){return F()}})}}),n(ne);var E=v(ne,6),O=v(i(E),2),X=i(O,!0);n(O),n(E);var Y=v(E,2);he(Y,5,()=>e(t),Fe,(A,d)=>{var c=Ut(),Q=i(c);ot(Q,{get item(){return e(d)}}),n(c),Be("click",c,()=>Ce(`bills?id=${e(d).id}`)),D(A,c)}),n(Y);var H=v(Y,2),G=v(i(H),2),W=i(G,!0);n(G),n(H),n(_);var se=v(_,2);n(T),U(()=>{q(X,e($)),q(W,e($))}),Be("click",se,()=>{Ce("bills/add")}),D(S,T),ue()}class jt{constructor(a){this.dbService=a}billStatements=Ne({fetching:!1,data:void 0,error:null});queryBillStatementsByBillIds(a){return(async()=>{try{const o=(await this.dbService.billStatements.toArray()).reduce((f,l)=>{const h={...l,bill:{id:l.billId},startDate:l.cycleFromDate,endDate:l.cycleToDate},I=`${Pe.BILL_STATEMENTS_KEY_PREFIX}${l.billId}`;return f[I]?f[I].push(h):f[I]=[h],f},{});a.forEach(f=>o[`${Pe.BILL_STATEMENTS_KEY_PREFIX}${f}`]||=[]),this.billStatements.update(f=>({...f,data:o,error:null,fetching:!1}))}catch(t){console.error(t)}})(),this.billStatements}async addBillStatement(a){const t={id:crypto.randomUUID(),...a,cycleFromDate:a.startDate,cycleToDate:a.endDate,bill:void 0,billId:a.bill.id};return await this.dbService.billStatements.add(t),a}}class Gt{constructor(a){this.dbService=a}transactionsForCurrentMonth=Ne({fetching:!1,data:void 0,error:null});queryTransactionsForCurrentMonth(){return(async()=>{try{const a=await this.dbService.transactions.toArray();this.transactionsForCurrentMonth.update(t=>({...t,data:a}))}catch(a){console.error(a)}})(),this.transactionsForCurrentMonth}}var Vt=B('<p class="svelte-n0pvsf">Loading...</p>'),Kt=B('<p class="svelte-n0pvsf">ðŸ™† Uh oh! Unable to fetch your bills!</p>'),Ht=B('<section class="timeline-page svelte-n0pvsf"><!></section>');function ia(S,a){ve(a,!1);const t=()=>fe(tt,"$liteDb",I),o=()=>fe(e(F),"$billsQuery",I),f=()=>fe(e(g),"$billStatsQuery",I),l=()=>fe(e(C),"$transactionsQuery",I),h=()=>fe(e($),"$billStatementsQuery",I),[I,P]=$e(),F=k(),$=k(),g=k(),C=k();let T=k(),_=k(),z=k();Te(()=>{w(T,new et(t())),w(_,new jt(t())),w(z,new Gt(t()))}),new Date().getUTCMonth()+1,new Date().getUTCFullYear();const ee=({bill:E,amount:O,isFullyPaid:X,cycleFromDate:Y,cycleToDate:H})=>e(_).addBillStatement({notes:"",amount:O,isFullyPaid:X,bill:{id:E.id},startDate:Y,endDate:H,edges:{paymentIds:[]}});ae(()=>e(T),()=>{pe(w(F,e(T)?.queryBills()),"$billsQuery",I)}),ae(()=>(o(),e(_)),()=>{pe(w($,!o()?.fetching&&!o()?.error?e(_)?.queryBillStatementsByBillIds(o().data?.map(E=>E.id)??[]):null),"$billStatementsQuery",I)}),ae(()=>(e(_),o()),()=>{pe(w(g,e(_)?.queryBillStatementsByBillIds(o()?.data?.map(E=>E.id)??[])),"$billStatsQuery",I)}),ae(()=>e(z),()=>{pe(w(C,e(z)?.queryTransactionsForCurrentMonth()),"$transactionsQuery",I)}),be(),_e();var V=Ht(),K=i(V);{var re=E=>{var O=Vt();D(E,O)},ne=E=>{var O=Re(),X=ce(O);{var Y=G=>{var W=Kt();D(G,W)},H=G=>{{let W=ie(()=>(o(),r(()=>o()?.data||[]))),se=ie(()=>(f(),r(()=>({stats:f()?.data||[]})))),A=ie(()=>(l(),r(()=>l()?.data||[]))),d=ie(()=>(h(),r(()=>h()?.data)));Yt(G,{get items(){return e(W)},get stats(){return e(se)},get transactions(){return e(A)},get billingStatements(){return e(d)},onRecordingPayment:ee})}};L(X,G=>{o(),f(),l(),r(()=>o()?.error||f()?.error||l()?.error)?G(Y):G(H,!1)},!0)}D(E,O)};L(K,E=>{o(),f(),l(),r(()=>o()?.fetching||f()?.fetching||l()?.fetching)?E(re):E(ne,!1)})}n(V),D(S,V),ue(),P()}export{ia as component};
