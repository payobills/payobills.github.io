import{L as ht,q as _,M as Dt,x as h,aW as pt,g as at,o as kt,l as rt,J as f,K as P,H as et,v as t,I as mt,z as F,C as d,B as v,G as u,F as ft,O as j,k as C,A as St,D as it,aX as _t,i as wt,j as yt,ad as Bt,aO as Ct,aY as xt}from"./B1x8ai2h.js";import"./DsnmJJEf.js";import"./69_IOA4Y.js";import{o as Pt,s as q,b as qt}from"./CudHTZsQ.js";import{p,i as U,a as Tt,s as Ft,b as Rt}from"./-QHvesP2.js";import{i as ot,e as gt,I as $t,n as It,l as ct,r as nt}from"./6PD_s1A2.js";import{C as dt,c as ut,b as Mt}from"./DntnSZ3E.js";import{i as bt}from"./DXIOgzev.js";import{b as Ot}from"./CjVXStdI.js";import{g as At}from"./BRDOIGdq.js";import{u as jt}from"./CO5dwDQB.js";function ve(n,a,r){ht(()=>{var c=_(()=>a(n,r?.())||{});if(r&&c?.update){var b=!1,i={};Dt(()=>{var g=r();h(g),b&&pt(i,g)&&(i=g,c.update(g))}),b=!0}if(c?.destroy)return()=>c.destroy()})}const tt=n=>{let a=n%10,r=n%100;return a===1&&r!==11?n+"st":a===2&&r!==12?n+"nd":a===3&&r!==13?n+"rd":n+"th"},Et=n=>{if(!n.billingDate)return null;const a=new Date,r=a.getFullYear(),c=a.getMonth(),b=a.getDate(),i=B=>B.toString().padStart(2,"0");function g(B,y,T){return`${B}-${i(y+1)}-${i(T)}`}let R=r,k=c,m=r,x=c,D,O;return D=n.billingDate+1,O=n.billingDate,k=n.billingDate>b?c-2:c-1,x=k+1,R=r,m=r,{fromDate:g(R,k,D),toDate:g(m,x,O)}};function Lt(n,a){at(a,!0),kt(()=>{jt.update(r=>({...r,content:a.children,onClose:a.onClose}))}),rt()}var Nt=F('<div class="actions"><button class="svelte-k426ci">Record payment</button></div>'),Gt=F('<div class="card-item svelte-k426ci"> </div>'),Qt=F('<div class="card-item svelte-k426ci">Total Payment made this cycle: <span class="current-bill-amount svelte-k426ci"> </span></div>'),Ut=F(`<div class="container svelte-k426ci"><a aria-label="anchor"></a> <div class="header svelte-k426ci"><div class="name svelte-k426ci"> </div> <!></div> <!> <div class="card-item svelte-k426ci">Bill generates <strong class="svelte-k426ci"> </strong> of every
    month and due <strong class="svelte-k426ci"> </strong> of every
    month</div> <!> <div class="card-item svelte-k426ci">Current bill status <span><strong class="svelte-k426ci"> </strong></span></div> <!></div>`);function Yt(n,a){at(a,!1);let r=p(a,"bill",8),c=p(a,"billingStatements",8),b=p(a,"showRecordPaymentButton",8,!0),i=p(a,"title",8,""),g=p(a,"showBillingCycle",8,!0),R=p(a,"onRecordingPayment",8);p(a,"onCurrentBillStatementDoesNotExist",8);let k=P(),m=P(),x=p(a,"currentCycleFromDate",12,""),D=p(a,"currentCycleToDate",12,""),O=P(),B=P(),y=P();Pt(()=>{f(k,new Date().getDate())}),et(()=>(h(r()),t(y),h(c()),t(k)),()=>{const s=Et(r());f(y,c()?.find(w=>w.startDate===s?.fromDate&&s?.toDate===w.endDate)),t(y)||f(y,{startDate:s?.fromDate,endDate:s?.toDate,amount:void 0}),x(s?.fromDate||""),D(s?.toDate||"");const o=r().payByDate-t(k);r().isEnabled?c()?t(y)?.isFullyPaid&&t(y)?.amount===0?f(m,{string:"No payment due",status:"paid"}):t(y)?.isFullyPaid?f(m,{string:"Fully Paid",status:"paid"}):o>0?f(m,{string:`Due in ${o} days`,status:"due",l2Status:o<=5?"warning":"ok"}):o<0?f(m,{string:`Overdue by ${-o} days`,status:"overdue"}):f(m,{string:"Due today",status:"today"}):f(m,{string:"Calculating ...",status:"loading"}):f(m,{string:"Disabled",status:"disabled"})}),mt(),bt();var T=Ut(),E=d(T),Y=v(E,2),H=d(Y),z=d(H,!0);u(H);var W=v(H,2);{var X=s=>{var o=Nt(),w=d(o);u(o),St("click",w,()=>{At(`#payment__bill_${r().id}`),f(B,null),f(B,r())}),C(s,o)};U(W,s=>{h(r()),h(b()),_(()=>r().isEnabled&&b())&&s(X)})}u(Y);var J=v(Y,2);{var L=s=>{Lt(s,{onClose:()=>{f(B,null)},children:(o,w)=>{{let K=it(()=>[t(y)]);te(o,{get bill(){return t(B)},get onRecordingPayment(){return R()},get billStatements(){return t(K)},get selectedStatement(){return t(y)}})}},$$slots:{default:!0}})};U(J,s=>{t(B)&&s(L)})}var N=v(J,2),G=v(d(N)),lt=d(G,!0);u(G);var Q=v(G,2),V=d(Q,!0);u(Q),ft(),u(N);var Z=v(N,2);{var l=s=>{var o=Gt(),w=d(o);u(o),j(()=>q(w,`Billing cycle: ${x()??""} - ${D()??""}`)),C(s,o)};U(Z,s=>{g()&&s(l)})}var e=v(Z,2),S=v(d(e)),$=d(S),A=d($,!0);u($),u(S),u(e);var M=v(e,2);{var I=s=>{var o=Qt(),w=v(d(o)),K=d(w);u(w),u(o),j(()=>q(K,`₹${t(y),_(()=>t(y)?.amount)??""}/-`)),C(s,o)};U(M,s=>{t(y),_(()=>t(y)?.amount>0)&&s(I)})}u(T),Ot(T,s=>f(O,s),()=>t(O)),j((s,o)=>{ot(E,"href",(h(r()),_(()=>`#payment__bill_${r().id}`))),q(z,(h(i()),h(r()),_(()=>i()?.length>0?i():r().name))),q(lt,s),q(V,o),gt(S,1,(t(m),_(()=>`due-status due-status--${t(m)?.status} ${t(m)?.l2Status?`due-status--${t(m)?.status}--${t(m)?.l2Status}`:""}`)),"svelte-k426ci"),q(A,(t(m),_(()=>t(m)?.string)))},[()=>(h(tt),h(r()),_(()=>tt(r().billingDate))),()=>(h(tt),h(r()),_(()=>tt(r().payByDate)))]),C(n,T),rt()}var Ht=async(n,a)=>{await a()?.(n)},zt=F('<button class="button-container svelte-6f3vd4"><!></button>');function Jt(n,a){at(a,!0);let r=p(a,"onclick",3,void 0),c=p(a,"state",3,"DEFAULT");var b=zt();b.__click=[Ht,r];var i=d(b);{var g=k=>{$t(k,{get icon(){return It},scale:.75})},R=k=>{var m=wt(),x=yt(m);qt(x,()=>a.children??Bt),C(k,m)};U(i,k=>{c()==="LOADING"?k(g):k(R,!1)})}u(b),C(n,b),rt()}_t(["click"]);const vt=n=>{const r=new Date().getTime()-n.getTime(),c=Math.floor(r/6e4),b=Math.floor(c/60),i=Math.floor(b/24),g=new Intl.RelativeTimeFormat("en",{numeric:"auto"});return c<1?"just now":c<60?g.format(-c,"minute"):b<24?g.format(-b,"hour"):i<31?g.format(-i,"day"):n.toLocaleDateString("en-GB")};var Kt=F("<p> </p>"),Wt=F("<div><!></div>"),Xt=F('<p><input type="checkbox" class="svelte-14qqrs6"/> <span> </span> <span> </span></p>'),Vt=F('<label for="record-bill-payment-amount">Total Amount (calculated from selected transactions)</label> <p class="total-amount svelte-14qqrs6"> </p>',1),Zt=F('<div class="container svelte-14qqrs6"><div class="form-container svelte-14qqrs6"><h2>Record a payment</h2> <label for="record-bill-payment-bill">Bill</label> <!> <label for="record-bill-statement">Bill Cycle</label> <!> <label for="record-bill-payment-amount">Amount</label> <input id="record-bill-payment-amount" placeholder="Enter amount paid or search" class="svelte-14qqrs6"/>  <!>  <!> <div class="checkbox-group svelte-14qqrs6"><label for="record-bill-payment-fullypaid">Fully Paid</label> <input type="checkbox" name="record-bill-payment-fullypaid" id="record-bill-payment-fullypaid" class="svelte-14qqrs6"/></div> <!></div></div>');function te(n,a){at(a,!1);const r=()=>Tt(t(B),"$matchingTransactionsQuery",c),[c,b]=Ft(),i=P(),g=P();let R=p(a,"bill",8),k=p(a,"billStatements",8),m=p(a,"onRecordingPayment",8),x=p(a,"lockBillStatementCycle",8,!1),D=p(a,"selectedStatement",8),O=p(a,"onTransactionSearch",8),B=P(),y=P(""),T=P(!0),E=P(!1);class Y{__state;__metadata;constructor(e,S){this.__state=e,this.__metadata=S}get state(){return this.__state}set state(e){this.__state=e}get metadata(){return this.__metadata}}const H=async()=>{try{Rt(f(B,await O()(t(y))),"$matchingTransactionsQuery",c)}catch{}};et(()=>r(),()=>{f(i,r()?.data?.reduce((l,e)=>(l={...l,[e.id.toString()]:new Y(!1,e)},l),{})??{})}),et(()=>t(i),()=>{f(g,Object.values(t(i)).filter(l=>l.state).reduce((l,e)=>l+e.metadata?.amount||0,0))}),et(()=>h(D()),()=>{console.log("selec",D())}),mt(),bt();var z=Zt(),W=d(z),X=v(d(W),4);{let l=it(()=>!x());Yt(X,{get bill(){return R()},billingStatements:[],showRecordPaymentButton:!1,onRecordingPayment:()=>{},get currentCycleFromDate(){return h(D()),_(()=>D().startDate)},get currentCycleToDate(){return h(D()),_(()=>D().endDate)},get showBillingCycle(){return t(l)}})}var J=v(X,4);ct(J,1,k,l=>l.id,(l,e)=>{var S=Wt(),$=d(S);dt($,{children:(A,M)=>{var I=Kt(),s=d(I,!0);u(I),j(()=>q(s,(t(e),_(()=>`${t(e).startDate} - ${t(e).endDate}`)))),C(A,I)},$$slots:{default:!0}}),u(S),j(()=>gt(S,1,(h(x()),t(e),h(D()),_(()=>`bill-statement ${x()?"bill-statement--locked":""} ${t(e).id===D().id?"bill-statement--selected":""}`)),"svelte-14qqrs6")),C(l,S)});var L=v(J,4);nt(L),L.__focusout=H;var N=v(L,2);ct(N,1,()=>(r(),_(()=>r()?.data)),l=>l.id,(l,e)=>{dt(l,{children:(S,$)=>{var A=Xt(),M=d(A);nt(M);var I=v(M,2),s=d(I,!0);u(I);var o=v(I,1,!0),w=v(o),K=d(w,!0);u(w),u(A),j(st=>{ot(M,"name",(t(e),_(()=>`record-bill-payment-transaction-${t(e).id}`))),ot(M,"id",(t(e),_(()=>`record-bill-payment-transaction-${t(e).id}`))),q(s,(t(e),_(()=>`₹${t(e).amount}/- `))),q(o,(t(e),_(()=>`at ${t(e).merchant??"Unknown Merchant"} · `))),q(K,st)},[()=>(h(vt),t(e),_(()=>vt(new Date(t(e).paidAt))))]),ut(M,()=>t(i)[t(e).id].state,st=>xt(i,t(i)[t(e).id].state=st)),C(S,A)},$$slots:{default:!0}})});var G=v(N,2);{var lt=l=>{var e=Vt(),S=v(yt(e),2),$=d(S,!0);u(S),j(()=>q($,`₹ ${t(g)}/-`)),C(l,e)};U(G,l=>{t(i),_(()=>Object.values(t(i)).filter(e=>e.state).length>0)&&l(lt)})}var Q=v(G,2),V=v(d(Q),2);nt(V),u(Q);var Z=v(Q,2);{let l=it(()=>t(E)?"LOADING":"DEFAULT");Jt(Z,{onclick:async()=>{f(E,!0),await m()({id:D().id,amount:Object.values(t(i)).filter(e=>e.state).length>0?t(g):+t(y),bill:R(),cycleFromDate:D().startDate,cycleToDate:D().endDate,isFullyPaid:t(T),transactions:Object.values(t(i)).filter(e=>e.state).map(e=>e.metadata)}),f(E,!1)},get state(){return t(l)},children:(e,S)=>{ft();var $=Ct("Record Payment");C(e,$)},$$slots:{default:!0}})}u(W),u(z),Mt(L,()=>t(y),l=>f(y,l)),ut(V,()=>t(T),l=>f(T,l)),C(n,z),rt(),b()}_t(["focusout"]);export{Yt as B,ve as a,vt as f};
